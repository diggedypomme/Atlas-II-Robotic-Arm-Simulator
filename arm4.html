<!DOCTYPE html>
<html>
<head>
  <title>Robot Arm Simulation</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
    }
    .command-button {
      display: inline-block;
      margin: 2px;
      padding: 5px 10px;
      background-color: #ccc;
      border: none;
      cursor: pointer;
      border-radius: 3px;
    }
    .command-button:hover {
      background-color: #bbb;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <div id="controls">
    <input type="text" id="commandInput" placeholder="Enter command">
    <button onclick="executeCommand()">OK</button>
    <br>
    <button class="command-button" onclick="fillAndSubmit('A100')">A100</button>
    <button class="command-button" onclick="fillAndSubmit('A10')">A10</button>
    <button class="command-button" onclick="fillAndSubmit('B50')">B50</button>
    <button class="command-button" onclick="fillAndSubmit('B10')">B10</button>
    <button class="command-button" onclick="fillAndSubmit('C100')">C100</button>
    <button class="command-button" onclick="fillAndSubmit('C10')">C10</button>
  </div>
  <script>
    // Setup the scene
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Add OrbitControls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Add lights
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 7.5).normalize();
    scene.add(directionalLight);

    // Define robot arm parts with correct pivot points
    function createArmPart(width, height, depth, color) {
      const geometry = new THREE.BoxGeometry(width, height, depth);
      const material = new THREE.MeshStandardMaterial({ color });
      const mesh = new THREE.Mesh(geometry, material);
      mesh.geometry.translate(0, height / 2, 0); // Set the pivot point to the bottom
      return mesh;
    }

    const base = createArmPart(1, 0.2, 1, 0x00ff00);
    scene.add(base);

    const arm = createArmPart(0.2, 2, 0.2, 0xff0000);
    arm.position.y = 0.1;
    base.add(arm);

    const claw = createArmPart(0.5, 0.2, 0.5, 0x0000ff);
    claw.position.y = 2;
    arm.add(claw);

    camera.position.z = 5;

    let targetBaseRotation = 0;
    let targetArmRotation = 0;
    let targetClawRotation = 0;

    const rotationSpeed = 0.01; // Adjust speed as needed

    function updateRotation(currentRotation, targetRotation) {
      if (Math.abs(targetRotation - currentRotation) < rotationSpeed) {
        return targetRotation;
      }
      return currentRotation + Math.sign(targetRotation - currentRotation) * rotationSpeed;
    }

    // Control logic
    function moveBasePan(newPosition) {
      targetBaseRotation = newPosition * Math.PI / 180; // Convert to radians
    }

    function moveArmTilt(newPosition) {
      targetArmRotation = newPosition * Math.PI / 180; // Convert to radians
    }

    function moveClawTilt(newPosition) {
      targetClawRotation = newPosition * Math.PI / 180; // Convert to radians
    }

    // Execute command
    function executeCommand() {
      const command = document.getElementById('commandInput').value;
      const motor = command.charAt(0);
      const position = parseInt(command.slice(1));

      switch (motor) {
        case 'A':
          moveBasePan(position);
          break;
        case 'B':
          moveArmTilt(position);
          break;
        case 'C':
          moveClawTilt(position);
          break;
        // Add more cases for other motors as needed
        default:
          console.log('Invalid command');
      }
    }

    // Fill and submit command
    function fillAndSubmit(command) {
      document.getElementById('commandInput').value = command;
      executeCommand();
    }

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);

      // Gradually move towards target rotations
      base.rotation.y = updateRotation(base.rotation.y, targetBaseRotation);
      arm.rotation.z = updateRotation(arm.rotation.z, targetArmRotation);
      claw.rotation.x = updateRotation(claw.rotation.x, targetClawRotation);

      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
